'use strict';function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step('next',value)},function(err){step('throw',err)})}}return step('next')})}}$(_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var _ref2,getAll,getType,nodes,i,$icons,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,icon,data,_DEVICE,TYPE,originalId,pageId,typeId,$icon;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getAllNodesInfo();case 3:_ref2=_context.sent;getAll=_ref2.getAll;getType=_ref2.getType;if(!(getAll.code===CODE.SUCCESS)){_context.next=13;break}nodes=getAll.data.nodes;if(DEBUG){console.log('\u670D\u52A1\u5668\u53D1\u9001\u8282\u70B9\u6570\u636E');console.log(nodes)}for(i=0;i<nodes.length;i++){originalIdToPageId[nodes[i].trim()]=i;pageIdToOriginalId[i]=nodes[i].trim()}if(DEBUG){console.log('\u524D\u7AEF\u6620\u5C04');console.log(originalIdToPageId)}_context.next=15;break;case 13:_context.next=15;return showNotice(getAll.msg);case 15:if(!(getType.code===CODE.SUCCESS)){_context.next=41;break}$icons=$('.icon');_iteratorNormalCompletion=true;_didIteratorError=false;_iteratorError=undefined;_context.prev=20;for(_iterator=$icons[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){icon=_step.value;$(icon).attr('data-deviceType','0');$(icon).css('background-image','url(\'./images/0.png\')')}_context.next=28;break;case 24:_context.prev=24;_context.t0=_context['catch'](20);_didIteratorError=true;_iteratorError=_context.t0;case 28:_context.prev=28;_context.prev=29;if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}case 31:_context.prev=31;if(!_didIteratorError){_context.next=34;break}throw _iteratorError;case 34:return _context.finish(31);case 35:return _context.finish(28);case 36:data=getType.data;_DEVICE=DEVICE,TYPE=_DEVICE.TYPE;for(originalId in data){if(data.hasOwnProperty(originalId)){originalId=originalId.trim();pageId=originalIdToPageId[originalId];typeId=data[originalId];$icon=$('.icon[data-nodeid='+pageId+']');$icon.attr('data-deviceType',data[originalId]);$icon.css('background-image','url(\'./images/'+typeId+'.png\')')}}_context.next=43;break;case 41:_context.next=43;return showNotice(getType.msg);case 43:_context.next=50;break;case 45:_context.prev=45;_context.t1=_context['catch'](0);console.log(_context.t1);_context.next=50;return showNotice(MSG.ERROR).catch(function(e){console.log(e)});case 50:case'end':return _context.stop();}}},_callee,undefined,[[0,45],[20,24,28,36],[29,,31,35]])})));$(function(){var socket=io();socket.on('connect',function(){console.log('socket \u8FDE\u63A5\u6210\u529F')});socket.on('disconnect',function(){console.log('socket \u65AD\u5F00\uFF0C\u8FDB\u884C\u91CD\u8FDE')});socket.on('nodeStatus',function(data){if(DEBUG){console.log('\u65B0\u7684\u8FDE\u63A5\u72B6\u6001 (\u539F\u59CB\u6570\u636E)');console.log(data)}var startSeq=void 0,endSeq=void 0;var processedLines={};var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _ref3=_step2.value;var startNode=_ref3.startNode;var endNode=_ref3.endNode;startSeq=originalIdToPageId[startNode];endSeq=originalIdToPageId[endNode];processedLines[startSeq+'-'+endSeq]=true}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}var processedLinesCopy=Object.assign({},processedLines);for(var key in processedLinesCopy){if(processedLinesCopy.hasOwnProperty(key)){var nodeNums=key.split('-');if(Object.is(processedLinesCopy[nodeNums[1]+'-'+nodeNums[0]],undefined)){delete processedLines[key]}else if(parseInt(nodeNums[0])>parseInt(nodeNums[1])){delete processedLines[key]}}}if(DEBUG){console.log('\u65B0\u7684\u8FDE\u63A5\u72B6\u6001');console.log(processedLines)}for(var i=0;i<34;i++){for(var j=i+1;j<35&&j-i<=7;j++){if(j-i===1||j-i===7){if(Object.is(processedLines[i+'-'+j],undefined)){$('.line[data-connectnodes='+i+'-'+j+']').removeClass('connected')}else if(processedLines[i+'-'+j]===true){$('.line[data-connectnodes='+i+'-'+j+']').addClass('connected')}}}}});socket.on('nodeType',function(data){var $icons=$('.icon');var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=$icons[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var icon=_step3.value;$(icon).attr('data-deviceType','0');$(icon).css('background-image','url(\'./images/0.png\')')}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}var _DEVICE2=DEVICE,TYPE=_DEVICE2.TYPE;for(var originalId in data){if(data.hasOwnProperty(originalId)){originalId=originalId.trim();var pageId=originalIdToPageId[originalId];var typeId=data[originalId];var $icon=$('.icon[data-nodeid='+pageId+']');$icon.attr('data-deviceType',data[originalId]);$icon.css('background-image','url(\'./images/'+typeId+'.png\')')}}})});