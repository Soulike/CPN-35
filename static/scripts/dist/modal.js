'use strict';function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step('next',value)},function(err){step('throw',err)})}}return step('next')})}}$(function(){var $icons=$('.icon');var $main=$('#main');$icons.click(function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(e){var pageId,nodeType,_$$position,top,left,$modal,$modalHeader,$modalBody,$infoArea,$formArea,_DEVICE,PARAMETERS,_PARAMETERS_TYPE,DATA,CONTROL,SWITCH,parameters,originalId,paraId,_parameters$paraId,type,name,$node,_$node,_$node2,_ref2,code,msg,data,_paraId,$para,_ref3,minLeft,minTop,maxLeft,maxTop;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;pageId=$(e.target).attr('data-nodeId');nodeType=$(e.target).attr('data-deviceType');_$$position=$(e.target).position(),top=_$$position.top,left=_$$position.left;$modal=$('<div class="modal" data-forNodeId="'+pageId+'">\n    <div class="modalHeaderArea">\n        <div class="modalHeader"></div>\n        <div class="modalClose">\xD7</div>\n    </div>\n    <div class="modalBody">\n        <div class="area infoArea"></div>\n        <div class="area formArea"></div>\n    </div>\n    <div class="modalFooter">\n        <div class="btnArea">\n            <button class="btn confirmBtn" data-forNodeId="'+pageId+'">\u786E\u5B9A</button>\n            <button class="btn cancelBtn">\u53D6\u6D88</button>\n        </div>\n    </div>\n</div>');$modalHeader=$modal.find('.modalHeader');$modalBody=$modal.find('.modalBody');$infoArea=$modal.find('.infoArea');$formArea=$modal.find('.formArea');_DEVICE=DEVICE,PARAMETERS=_DEVICE.PARAMETERS;_PARAMETERS_TYPE=PARAMETERS_TYPE,DATA=_PARAMETERS_TYPE.DATA,CONTROL=_PARAMETERS_TYPE.CONTROL,SWITCH=_PARAMETERS_TYPE.SWITCH;parameters=PARAMETERS[nodeType];originalId=getOriginalId(pageId);$modalHeader.text(originalId);_context4.t0=regeneratorRuntime.keys(parameters);case 15:if((_context4.t1=_context4.t0()).done){_context4.next=34;break}paraId=_context4.t1.value;if(!parameters.hasOwnProperty(paraId)){_context4.next=32;break}_parameters$paraId=parameters[paraId],type=_parameters$paraId.type,name=_parameters$paraId.name;paraId=paraId.toString()[0]==='0'?paraId.toString():'0'+paraId;_context4.t2=type;_context4.next=_context4.t2===DATA?23:_context4.t2===CONTROL?26:_context4.t2===SWITCH?29:32;break;case 23:$node=$('<div class="area">\n <span class="label">'+name+'</span>\n <span data-paraType="data" data-paraId="'+paraId+'"></span>\n </div>');$infoArea.append($node);return _context4.abrupt('break',32);case 26:_$node=$('<label class="control area">'+name+'<input data-paraType="control" data-paraId="'+paraId+'" type="text"></label>');$formArea.append(_$node);return _context4.abrupt('break',32);case 29:_$node2=$('<div class="radioArea" data-paraType="switch" data-paraId="'+paraId+'">\n <span class="label">'+name+'</span>\n <label class="radio">\n <input type="radio" value="true" name="'+paraId+'Radio">\u5F00</label>\n <label class="radio">\n <input type="radio" value="false" name="'+paraId+'Radio">\u5173</label>\n </div>');$formArea.append(_$node2);return _context4.abrupt('break',32);case 32:_context4.next=15;break;case 34:_context4.next=36;return getNodeInfo(pageId);case 36:_ref2=_context4.sent;code=_ref2.code;msg=_ref2.msg;data=_ref2.data;if(!(code===CODE.SUCCESS)){_context4.next=58;break}for(_paraId in data){if(data.hasOwnProperty(_paraId)){_paraId=_paraId.trim().toUpperCase();$para=$modalBody.find('*[data-paraId="'+_paraId+'"]');if($para.length!==0){if($para.prop('tagName').toLowerCase()==='div'&&$para.attr('data-paraType')==='switch'){$para.find('input[value='+data[_paraId]+']').prop('checked','true')}else if($para.prop('tagName').toLowerCase()==='input'&&$para.attr('data-paraType')==='control'){$para.val(data[_paraId])}else if($para.prop('tagName').toLowerCase()==='span'&&$para.attr('data-paraType')==='data'){$para.text(data[_paraId])}}}}_context4.next=44;return getModalMaxPosition();case 44:_ref3=_context4.sent;minLeft=_ref3.minLeft;minTop=_ref3.minTop;maxLeft=_ref3.maxLeft;maxTop=_ref3.maxTop;$modal.css({display:'none',position:'absolute',left:left<minLeft?minLeft:left>maxLeft?maxLeft:left,top:top<minTop?minTop:top>maxTop?maxTop:top});$main.append($modal);$modal.find('.modalClose').click(function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee(e){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;e.preventDefault();_context.next=4;return hideModal($modal);case 4:_context.next=9;break;case 6:_context.prev=6;_context.t0=_context['catch'](0);console.log(_context.t0);case 9:case'end':return _context.stop();}}},_callee,undefined,[[0,6]])}));return function(_x2){return _ref4.apply(this,arguments)}}());$modal.find('.cancelBtn').click(function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(e){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;e.preventDefault();_context2.next=4;return hideModal($modal);case 4:_context2.next=9;break;case 6:_context2.prev=6;_context2.t0=_context2['catch'](0);console.log(_context2.t0);case 9:case'end':return _context2.stop();}}},_callee2,undefined,[[0,6]])}));return function(_x3){return _ref5.apply(this,arguments)}}());$modal.find('.confirmBtn').click(function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(e){var _$formArea,$switches,$controls,temp,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,s,$checked,_paraId2,_iteratorNormalCompletion2,_didIteratorError2,_iteratorError2,_iterator2,_step2,c,_paraId3,_ref7,_code,_msg;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;e.preventDefault();_$formArea=$modal.find('.formArea');$switches=_$formArea.find('div[data-paraType=switch]');$controls=_$formArea.find('input[data-paraType=control]');temp={id:getOriginalId(pageId),data:{}};_iteratorNormalCompletion=true;_didIteratorError=false;_iteratorError=undefined;_context3.prev=9;for(_iterator=$switches[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){s=_step.value;$checked=$(s).find('input[checked=true]');_paraId2=$(s).attr('data-paraId');temp.data[_paraId2]=$checked.attr('value')==='true'}_context3.next=17;break;case 13:_context3.prev=13;_context3.t0=_context3['catch'](9);_didIteratorError=true;_iteratorError=_context3.t0;case 17:_context3.prev=17;_context3.prev=18;if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}case 20:_context3.prev=20;if(!_didIteratorError){_context3.next=23;break}throw _iteratorError;case 23:return _context3.finish(20);case 24:return _context3.finish(17);case 25:_iteratorNormalCompletion2=true;_didIteratorError2=false;_iteratorError2=undefined;_context3.prev=28;for(_iterator2=$controls[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){c=_step2.value;_paraId3=$(c).attr('data-paraId');temp.data[_paraId3]=$(c).val()}_context3.next=36;break;case 32:_context3.prev=32;_context3.t1=_context3['catch'](28);_didIteratorError2=true;_iteratorError2=_context3.t1;case 36:_context3.prev=36;_context3.prev=37;if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}case 39:_context3.prev=39;if(!_didIteratorError2){_context3.next=42;break}throw _iteratorError2;case 42:return _context3.finish(39);case 43:return _context3.finish(36);case 44:_context3.next=46;return postAsync('/cpn/node/modify',temp);case 46:_ref7=_context3.sent;_code=_ref7.code;_msg=_ref7.msg;_context3.next=51;return showNotice(_msg.trim(),_code===CODE.SUCCESS);case 51:if(!(_code===CODE.SUCCESS)){_context3.next=54;break}_context3.next=54;return hideModal($modal);case 54:_context3.next=61;break;case 56:_context3.prev=56;_context3.t2=_context3['catch'](0);console.log(_context3.t2);_context3.next=61;return showNotice('\u8BBE\u5907\u4FE1\u606F\u4FEE\u6539\u5931\u8D25').catch(function(e){console.log(e)});case 61:case'end':return _context3.stop();}}},_callee3,undefined,[[0,56],[9,13,17,25],[18,,20,24],[28,32,36,44],[37,,39,43]])}));return function(_x4){return _ref6.apply(this,arguments)}}());_context4.next=56;return fadeInAsync($modal,150);case 56:_context4.next=60;break;case 58:_context4.next=60;return showNotice(msg);case 60:_context4.next=67;break;case 62:_context4.prev=62;_context4.t3=_context4['catch'](0);console.log(_context4.t3);_context4.next=67;return showNotice('\u8BBE\u5907\u4FE1\u606F\u83B7\u53D6\u5931\u8D25').catch(function(e){console.log(e)});case 67:case'end':return _context4.stop();}}},_callee4,undefined,[[0,62]])}));return function(_x){return _ref.apply(this,arguments)}}())});